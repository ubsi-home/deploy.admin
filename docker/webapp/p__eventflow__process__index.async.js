(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[92],{"1tP/":function(e,t,a){e.exports={header:"antd-pro-pages-eventflow-process-index-header",search:"antd-pro-pages-eventflow-process-index-search",cols:"antd-pro-pages-eventflow-process-index-cols",content:"antd-pro-pages-eventflow-process-index-content",btns:"antd-pro-pages-eventflow-process-index-btns",modelMsg:"antd-pro-pages-eventflow-process-index-modelMsg",check:"antd-pro-pages-eventflow-process-index-check",arrow:"antd-pro-pages-eventflow-process-index-arrow",codeMirror:"antd-pro-pages-eventflow-process-index-codeMirror",iframe:"antd-pro-pages-eventflow-process-index-iframe",processDrawer:"antd-pro-pages-eventflow-process-index-processDrawer"}},tPqr:function(e,t,a){"use strict";a.r(t);a("bbsP");var n=a("/wGt"),l=(a("g9YV"),a("wCAj")),r=(a("+L6B"),a("2/Rp")),o=(a("/zsF"),a("PArb")),s=(a("P2fV"),a("NJEC")),c=(a("5Dmo"),a("3S7+")),i=(a("miYZ"),a("tsqr")),p=a("2Taf"),u=a.n(p),d=a("vZ4D"),f=a.n(d),m=a("MhPg"),v=a.n(m),w=a("l4Ni"),y=a.n(w),h=a("ujKo"),E=a.n(h),g=(a("2qtc"),a("kLXV")),k=(a("5NDa"),a("5rEg")),x=(a("OaEy"),a("2fM7")),b=(a("y8nQ"),a("Vl3Y")),D=a("q1tI"),_=a.n(D),L=a("wd/R"),C=a.n(L),M=a("MuoO"),P=a("1tP/"),F=a.n(P),T=(a("IV+2"),a("a2PE"),a("P4xi")),N=a("6Hmz");function S(e){var t=q();return function(){var a,n=E()(e);if(t){var l=E()(this).constructor;a=Reflect.construct(n,arguments,l)}else a=n.apply(this,arguments);return y()(this,a)}}function q(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}a("p77/"),a("jX7t"),a("u8op");var V=N["a"].eventFlow_LCGL_ProcessCX.key,Y=N["a"].eventFlow_LCGL_ProcessE.key,A=N["a"].eventFlow_LCGL_ProcessDel.key,O=b["a"].Item,R=x["a"].Option,j=(k["a"].TextArea,g["a"].confirm,function(e){v()(a,e);var t=S(a);function a(){var e;u()(this,a);for(var n=arguments.length,l=new Array(n),r=0;r<n;r++)l[r]=arguments[r];return e=t.call.apply(t,[this].concat(l)),e.state={scriptList:[],flowList:[],processData:null,type:null,visible:!1,visible2:!1,drawerTitle:""},e.query=function(){e.queryFlow(),e.setState({scriptList:[]});var t=void 0==e.props.location.params?null:e.props.location.params._id;e.props.dispatch({type:"processModel/listProcess",payload:{flow:t,event:null,eventData:null,status:null,sortby:["startTime",-1],skip:0,limit:0},callback:function(t){if("0"==t.code){var a=t.data[1];a.forEach(function(t){var a=[t.flow];e.getFlow(a,t)})}else i["a"].error("\u83b7\u53d6\u5168\u90e8\u6d41\u7a0b\u5b9e\u4f8b\u51fa\u9519")}})},e.getFlow=function(t,a){var n=[];e.props.dispatch({type:"processModel/getFlow",payload:{ids:t},callback:function(t){"0"==t.code?(a.flowName=t.data[0].name,n.push(a),e.setState({scriptList:e.state.scriptList.concat(n)})):i["a"].error("\u83b7\u53d6\u6d41\u7a0b\u51fa\u9519")}}),e.setState({scriptList:e.state.scriptList.concat(n)})},e.queryFlow=function(){e.props.dispatch({type:"processModel/listFlow",payload:{name:null,event:null,domain:null,status:null,sortby:null,skip:0,limit:0},callback:function(t){"0"==t.code?e.setState({flowList:t.data[1]}):i["a"].error("\u83b7\u53d6\u5168\u90e8\u6d41\u7a0b\u51fa\u9519")}})},e.del=function(t){var a=e.props.dispatch;console.log("===daa=t===",t),g["a"].confirm({title:"\u786e\u8ba4\u5220\u9664 '".concat(t._id?t._id:"\u8be5\u6267\u884c\u5b9e\u4f8b","' \u5417?"),content:"",okText:"\u662f",okType:"danger",cancelText:"\u5426",onOk:function(){a({type:"processModel/delProcess",payload:{process:t._id},callback:function(t){"0"==t.code?(i["a"].success("\u6d41\u7a0b\u5b9e\u4f8b\u5220\u9664\u6210\u529f\uff01"),e.query()):i["a"].error("\u6d41\u7a0b\u5b9e\u4f8b\u5220\u9664\u5931\u8d25\uff01")}})},onCancel:function(){}})},e.stopProcess=function(t){e.props.dispatch({type:"processModel/stopProcess",payload:{process:t._id},callback:function(t){"0"==t.code?(i["a"].success("\u7ec8\u6b62\u6d41\u7a0b\u5b9e\u4f8b\u6210\u529f\uff01"),e.query()):i["a"].error("\u7ec8\u6b62\u6d41\u7a0b\u5b9e\u4f8b\u5931\u8d25\uff01")}})},e.openDrawer=function(t,a,n){console.log("drawerTitle============:",n),n?e.setState({visible:!0,drawerTitle:a,type:t,processData:n}):e.setState({visible:!0,drawerTitle:a,type:t})},e.drawerClose=function(){e.setState({visible:!1,drawerTitle:"",type:null})},e.by=function(e){return function(t,a){var n,l;if("object"===typeof t&&"object"===typeof a&&t&&a)return n=t[e],l=a[e],n===l?0:typeof n===typeof l?n>l?-1:1:typeof n>typeof l?-1:1;throw"error"}},e}return f()(a,[{key:"componentDidMount",value:function(){this.query()}},{key:"render",value:function(){var e=this,t=this.state,a=t.scriptList,p=(t.params,t.flowList),u=t.processData;a.sort(this.by("startTime"));var d=this.props.form.getFieldDecorator,f=void 0==this.props.location.params?null:this.props.location.params._id,m=(void 0==this.props.location.params||this.props.location.params.name,[]);p.forEach(function(e){m.push(_.a.createElement(R,{key:e._id},e.name))});var v=[{title:"\u6d41\u7a0b\u6807\u8bc6",align:"center",width:"300",render:function(e){return _.a.createElement(c["a"],{placement:"top",title:_.a.createElement("pre",null,"\u6d41\u7a0b\u6570\u636e\uff1a",JSON.stringify(e.flowData,null,"\t"))},_.a.createElement("span",null,e.flowName))}},{title:"\u542f\u52a8\u4e8b\u4ef6",align:"center",render:function(e){return _.a.createElement(c["a"],{placement:"top",title:_.a.createElement("pre",null,"\u4e8b\u4ef6\u6570\u636e\uff1a",JSON.stringify(e.eventData,null,"\t"))},_.a.createElement("span",null,e.event))}},{title:"\u72b6\u6001",align:"center",render:function(e){return _.a.createElement(c["a"],{placement:"top",title:"\u6267\u884c\u7ed3\u679c\uff1a".concat(null==e.result?"":e.result)},_.a.createElement("span",null,"0"==e.status?"\u6267\u884c\u4e2d":"1"==e.status?"\u6b63\u5e38\u7ed3\u675f":"-1"==e.status?"\u5931\u8d25\u6216\u5f02\u5e38":"-2"==e.status?"\u624b\u5de5\u7ec8\u6b62":""))}},{title:"\u6d41\u7a0b\u5f00\u59cb\u65f6\u95f4",dataIndex:"startTime",align:"center",render:function(e){return _.a.createElement("span",null,e&&C()(e).format("YYYY-MM-DD"),"\xa0",e&&C()(e).format("HH:mm:ss"))}},{title:"\u6d41\u7a0b\u7ed3\u675f\u65f6\u95f4",dataIndex:"stopTime",align:"center",render:function(e){return _.a.createElement("span",null,e&&C()(e).format("YYYY-MM-DD"),"\xa0",e&&C()(e).format("HH:mm:ss"))}},{title:"\u64cd\u4f5c",align:"center",width:"20%",render:function(t){return _.a.createElement("span",null,0==t.status?_.a.createElement("span",null,_.a.createElement(s["a"],{title:"\u786e\u5b9a\u7ec8\u6b62\u542f\u52a8\u4e8b\u4ef6\u4e3a\uff1a".concat(t.event,"\u7684\u6d41\u7a0b\u5b9e\u4f8b\u5417\uff1f"),onConfirm:function(){e.stopProcess(t)},onCancel:function(){},cancelText:"\u5426",okText:"\u662f"},_.a.createElement("a",null,"\u7ec8\u6b62")),_.a.createElement(o["a"],{type:"vertical"})):null,_.a.createElement("a",{onClick:function(a){a&&a.preventDefault(),T["a"].checkAuthAndExecute(e.props.dispatch,Y,function(){return e.openDrawer("03",t.flowName,t)},[null])}},"\u6267\u884c\u6b65\u9aa4"),_.a.createElement(o["a"],{type:"vertical"}),_.a.createElement("a",{onClick:function(a){a&&a.preventDefault(),T["a"].checkAuthAndExecute(e.props.dispatch,A,function(){return e.del(t)},[])}},"\u5220\u9664"))}}],w=function(){e.setState({scriptList:[]});var t=e.props,a=t.form,n=(t.dispatch,null==f?a.getFieldValue("cx_flowEvent"):f);console.log("cx_flowEvent==============:",n),console.log("flowNames==============:",f),console.log("form.getFieldValue(==============:",a.getFieldValue("cx_flowEvent")),n=void 0==n?null:n;var l=void 0!=a.getFieldValue("cx_flowStatus")?a.getFieldValue("cx_flowStatus"):null;l=1==l?null:l,e.props.dispatch({type:"processModel/listProcess",payload:{flow:n,event:null,eventData:null,status:l,sortby:null,skip:0,limit:0},callback:function(t){if("0"==t.code){var a=t.data[1];a.length>0?a.forEach(function(t){var a=[t.flow];e.getFlow(a,t)}):e.setState({scriptList:a}),i["a"].success("\u67e5\u8be2\u6210\u529f")}else i["a"].error("\u67e5\u8be2\u51fa\u9519")}})},y=function(){var t=e.props,a=t.form;t.dispatch;a.resetFields(),e.query(),i["a"].success("\u91cd\u7f6e\u6210\u529f")},h="03"==this.state.type?_.a.createElement("iframe",{className:F.a.iframe,src:"/eventflow/#/process/{'id':'".concat(u._id,"','flow':'").concat(u.flow,"','url':'/rest','token':'").concat(T["a"].getRoleToken(),"'}")},"\u6267\u884c\u6b65\u9aa4"):null;return _.a.createElement("div",null,_.a.createElement("div",{className:F.a.header},_.a.createElement(b["a"],{layout:"inline"},_.a.createElement("div",{className:F.a.search},_.a.createElement("div",null,_.a.createElement("div",{className:F.a.cols},_.a.createElement(O,{label:_.a.createElement("span",{style:{width:"60px",display:"inline-block"}},"\u6d41\u7a0b\u6807\u8bc6")},d("cx_flowEvent",{initialValue:f||void 0})(_.a.createElement(x["a"],{style:{width:"300px"},placeholder:"\u8bf7\u9009\u62e9\u6d41\u7a0b\u540d",allowClear:!0},m))),_.a.createElement(O,{label:_.a.createElement("span",{style:{width:"60px",display:"inline-block"}},"\u6d41\u7a0b\u72b6\u6001")},d("cx_flowStatus")(_.a.createElement(x["a"],{style:{width:"300px"},placeholder:"\u8bf7\u9009\u62e9\u60f3\u8981\u67e5\u8be2\u7684\u72b6\u6001\uff01",allowClear:!0},_.a.createElement(R,{value:-1},"\u5df2\u7ed3\u675f"),_.a.createElement(R,{value:0},"\u672a\u7ed3\u675f"),_.a.createElement(R,{value:1},"\u5168\u90e8")))))),_.a.createElement("span",{className:F.a.submitButtons},_.a.createElement(r["a"],{type:"primary",onClick:function(t){t&&t.preventDefault(),T["a"].checkAuthAndExecute(e.props.dispatch,V,w,[null])}},"\u67e5\u8be2"),_.a.createElement(r["a"],{style:{marginLeft:8},onClick:y},"\u91cd\u7f6e"))))),_.a.createElement("div",{className:F.a.content},_.a.createElement("div",null,_.a.createElement(l["a"],{columns:v,dataSource:a,size:"small",rowKey:function(e){return e._id}}))),_.a.createElement(n["a"],{title:this.state.drawerTitle,onClose:this.drawerClose,visible:this.state.visible,destroyOnClose:!0,className:F.a.processDrawer},h))}}]),a}(D["Component"]));t["default"]=Object(M["connect"])(function(e){return e.processModel})(b["a"].create()(j))}}]);