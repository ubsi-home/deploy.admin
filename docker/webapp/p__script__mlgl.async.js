(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[98],{AdWZ:function(e,t,a){"use strict";a.r(t);a("bbsP");var n=a("/wGt"),l=(a("g9YV"),a("wCAj")),r=(a("Pwec"),a("CtXQ")),i=(a("+L6B"),a("2/Rp")),o=a("jehZ"),c=a.n(o),s=(a("/zsF"),a("PArb")),d=(a("+BJd"),a("mr32")),u=(a("5Dmo"),a("3S7+")),p=(a("miYZ"),a("tsqr")),m=a("gWZ8"),h=a.n(m),f=a("2Taf"),y=a.n(f),g=a("vZ4D"),w=a.n(g),b=a("MhPg"),E=a.n(b),v=a("l4Ni"),R=a.n(v),k=a("ujKo"),_=a.n(k),S=(a("2qtc"),a("kLXV")),x=(a("5NDa"),a("5rEg")),C=(a("OaEy"),a("2fM7")),D=(a("y8nQ"),a("Vl3Y")),A=a("q1tI"),L=a.n(A),F=a("lZ7h"),V=a.n(F),T=(a("wd/R"),a("CyYT")),j=a("BMLG"),J=a("MuoO"),N=a("P4xi"),q=a("6Hmz");function M(e,t){var a="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=W(e))||t&&e&&"number"===typeof e.length){a&&(e=a);var n=0,l=function(){};return{s:l,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:l}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,i=!0,o=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return i=e.done,e},e:function(e){o=!0,r=e},f:function(){try{i||null==a.return||a.return()}finally{if(o)throw r}}}}function W(e,t){if(e){if("string"===typeof e)return I(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?I(e,t):void 0}}function I(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}function O(e){var t=B();return function(){var a,n=_()(e);if(t){var l=_()(this).constructor;a=Reflect.construct(n,arguments,l)}else a=n.apply(this,arguments);return R()(this,a)}}function B(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var G=q["a"].WebFW_MLGL_CX.key,Z=q["a"].WebFW_MLGL_AddDir.key,P=q["a"].WebFW_MLGL_DirName.key,Y=q["a"].WebFW_MLGL_Edit.key,z=q["a"].WebFW_MLGL_SC.key,X=D["a"].Item,Q=(C["a"].Option,x["a"].TextArea),H=(S["a"].confirm,function(e){E()(a,e);var t=O(a);function a(){var e;y()(this,a);for(var n=arguments.length,l=new Array(n),r=0;r<n;r++)l[r]=arguments[r];return e=t.call.apply(t,[this].concat(l)),e.state={visible:!1,type:null,drawerTitle:null,loading:!0,listDir:[],dataDir:null,roleType:null,jsglVisible:!1,readRole:[],writeRole:[],edit_readRole:[],edit_writeRole:[],rolesList:[]},e.query=function(){e.props.dispatch({type:"mlgl/listDir",payload:{name:null,skip:0,limit:0},callback:function(t){if("0"!=t.code)return e.setState({loading:!1}),p["a"].error("\u67e5\u8be2\u76ee\u5f55\u5217\u8868\u9519\u8bef\uff1a".concat(t.data));var a=t.data[1],n=[];a.map(function(e){var t=e.read,a=e.write;e.path;t&&n.push.apply(n,h()(t)),a&&n.push.apply(n,h()(a))}),e.queryNameById(n),setTimeout(function(){e.setState({loading:!1,listDir:a})},100)}})},e.queryNameById=function(t){t=Array.from(new Set(t));var a=[];t.map(function(t){var n=t.split(":");e.props.dispatch({type:"mlgl/getRoles",payload:{domain:n[0],nodes:[n[1]]},callback:function(t){0==t.code&&(t.data[0]&&a.push(t.data[0]),e.setState({rolesList:a}))}})})},e.del=function(t){var a=e.props.dispatch;S["a"].confirm({title:"\u786e\u8ba4\u5220\u9664 '".concat(t.name,"' \u5417?"),content:"",okText:"\u662f",okType:"danger",cancelText:"\u5426",onOk:function(){a({type:"mlgl/delDir",payload:{id:t._id,reqData:t},callback:function(t){"0"==t.code?(e.query(),p["a"].success("\u5220\u9664\u6210\u529f\uff01")):p["a"].error("\u5220\u9664\u5931\u8d25 \uff01".concat(t.data))}})},onCancel:function(){}})},e.reset=function(){e.props.form.resetFields(),e.query(),p["a"].success("\u91cd\u7f6e\u6210\u529f")},e.handleRoles=function(t){var a,n=e.state.rolesList,l={},r=M(n);try{for(r.s();!(a=r.n()).done;){var i=a.value;if(i._id==t)return l._id=i._id,l.name=i.name,l}}catch(e){r.e(e)}finally{r.f()}return l._id=t,l.name=t,l},e.openDrawer=function(t,a,n){e.props.dispatch;if(console.log("===data==",n),n){var l=n.read,r=n.write,i=[],o=[];l&&l.map(function(t){i.push(e.handleRoles(t))}),r&&r.map(function(t){o.push(e.handleRoles(t))}),setTimeout(function(){e.setState({visible:!0,type:t,drawerTitle:a,dataDir:n,edit_readRole:i,edit_writeRole:o})},100)}else e.setState({visible:!0,type:t,drawerTitle:a})},e.drawerClose=function(){e.setState({visible:!1,type:null,drawerTitle:null})},e.getJsglMsg=function(t){console.log("\u6dfb\u52a0role",t);var a=e.state.roleType;"readRole"==a?e.setState({readRole:t}):"writeRole"==a?e.setState({writeRole:t}):"edit_readRole"==a?e.setState({edit_readRole:t}):"edit_writeRole"==a&&e.setState({edit_writeRole:t}),e.setState({jsglVisible:!1})},e.closeJsgl=function(){e.setState({jsglVisible:!1})},e.showJsgl=function(t){console.log(t),e.setState({jsglVisible:!0,roleType:t})},e.handleSearch=function(){var t=e.props,a=t.dispatch,n=t.form,l=n.getFieldValue("cx_name");a({type:"mlgl/listDir",payload:{name:l||null,skip:0,limit:0},callback:function(t){if("0"!=t.code)return p["a"].error("\u67e5\u8be2\u76ee\u5f55\u5217\u8868\u9519\u8bef\uff1a".concat(t.data));e.setState({listDir:t.data[1]}),p["a"].success("\u67e5\u8be2\u6210\u529f")}})},e.handleSubmit=function(){var t=e.props,a=t.dispatch,n=t.form,l=e.state,r=l.type,i=l.dataDir,o=l.readRole,c=l.writeRole,s=l.edit_readRole,d=l.edit_writeRole,u=l.listDir,m=n.getFieldValue("name")?n.getFieldValue("name"):null,h=n.getFieldValue("path")?n.getFieldValue("path"):null,f=n.getFieldValue("desc")?n.getFieldValue("desc"):null,y=[],g=[];if(u.forEach(function(e){y.push(e.name),g.push(e.path)}),"01"==r){var w=[],b=[];if(o.map(function(e){w.push(e._id)}),c.map(function(e){b.push(e._id)}),null==m)return p["a"].warning("\u6743\u9650\u540d\u79f0\u5fc5\u586b\uff01");if(y.includes(m))return p["a"].warning("\u76ee\u5f55\u6620\u5c04\u540d\u79f0\u5df2\u7ecf\u5b58\u5728\uff0c\u6dfb\u52a0\u5931\u8d25\uff01");if(null==h)return p["a"].warning("\u771f\u5b9e\u8def\u5f84\u5fc5\u586b\uff01");if(g.includes(h))return p["a"].warning("\u76ee\u5f55\u771f\u5b9e\u8def\u5f84\u5df2\u7ecf\u5b58\u5728\uff0c\u6dfb\u52a0\u5931\u8d25\uff01");a({type:"mlgl/setDir",payload:{dir:{name:m,desc:f,path:h,read:w.length>0?w:null,write:b.length>0?b:null}},callback:function(t){"0"==t.code?(e.query(),p["a"].success("\u6dfb\u52a0\u6210\u529f\uff01"),e.setState({visible:!1,readRole:[],writeRole:[]})):p["a"].error("\u6dfb\u52a0\u5931\u8d25 \uff01".concat(t.data))}})}if("02"==r){var E=[],v=[];if(s.map(function(e){E.push(e._id)}),d.map(function(e){v.push(e._id)}),i.name==m);else if(y.includes(m))return p["a"].warning("\u76ee\u5f55\u6620\u5c04\u540d\u79f0\u5df2\u7ecf\u5b58\u5728\uff0c\u4fee\u6539\u5931\u8d25\uff01");if(g.includes(h))return p["a"].warning("\u76ee\u5f55\u771f\u5b9e\u8def\u5f84\u5df2\u7ecf\u5b58\u5728\uff0c\u4fee\u6539\u5931\u8d25\uff01");console.log("\u7f16\u8f91",E,v),a({type:"mlgl/setDir",payload:{dir:{_id:i._id,name:m||i.name,path:i.path,desc:f||i.desc,read:E.length>0?E:null,write:v.length>0?v:null},reqData:i},callback:function(t){"0"==t.code?(e.query(),p["a"].success("\u4fee\u6539\u6210\u529f\uff01"),e.setState({visible:!1})):p["a"].error("\u4fee\u6539\u5931\u8d25 \uff01".concat(t.data))}})}},e.handle=function(t){var a,n=e.state.rolesList,l=M(n);try{for(l.s();!(a=l.n()).done;){var r=a.value;if(r._id==t)return r.name}}catch(e){l.e(e)}finally{l.f()}return t},e}return w()(a,[{key:"componentDidMount",value:function(){this.query()}},{key:"handleChange",value:function(e,t){console.log("\u5220\u9664role",e);var a=this.state,n=a.readRole,l=a.writeRole,r=a.edit_readRole,i=a.edit_writeRole;if("readRole"==t){var o=[];e.map(function(e){n.map(function(t){e==t.name&&o.push(t)})}),this.setState({readName:e,readRole:o})}else if("writeRole"==t){var c=[];e.map(function(e){l.map(function(t){e==t.name&&c.push(t)})}),this.setState({writeName:e,writeRole:c})}else if("edit_readRole"==t){var s=[];e.map(function(e){r.map(function(t){e==t.name&&s.push(t)})}),this.setState({edit_readName:e,edit_readRole:s})}else if("edit_writeRole"==t){var d=[];e.map(function(e){i.map(function(t){e==t.name&&d.push(t)})}),this.setState({edit_writeRole:d})}}},{key:"render",value:function(){var e=this,t=this.props.form.getFieldDecorator,a=this.state,o=a.dataDir,p=a.readRole,m=a.writeRole,h=a.edit_readRole,f=a.edit_writeRole,y=a.roleType,g=[{title:"\u76ee\u5f55\u6620\u5c04\u540d\u79f0",render:function(t){return L.a.createElement("span",null,L.a.createElement("a",{style:{userSelect:"none"},onClick:function(a){a&&a.preventDefault(),N["a"].checkAuthAndExecute(e.props.dispatch,P,function(){return e.openDrawer("03","\u6587\u4ef6\u5939\u7ba1\u7406",t)},[null])}},t.name))}},{title:"\u771f\u5b9e\u8def\u5f84",dataIndex:"path",render:function(e){return L.a.createElement(u["a"],{placement:"top",title:"\u771f\u5b9e\u8def\u5f84\uff1a".concat(void 0==e?"":e)},e)}},{title:"\u6620\u5c04\u8bf4\u660e",dataIndex:"desc",align:"center",render:function(e){return L.a.createElement(u["a"],{placement:"top",title:"\u6620\u5c04\u8bf4\u660e\uff1a".concat(void 0==e?"":e)},e)}},{title:"\u53ef\u8bfb\u7684\u89d2\u8272",dataIndex:"read",align:"center",width:"25%",render:function(t){return L.a.createElement("span",null,t?t.map(function(t){return L.a.createElement(d["a"],{color:"red"},e.handle(t))}):[])}},{title:"\u53ef\u5199\u7684\u89d2\u8272",dataIndex:"write",width:"25%",align:"center",render:function(t){return t?t.map(function(t){return L.a.createElement(d["a"],{color:"red"},e.handle(t))}):[]}},{title:"\u64cd\u4f5c",align:"center",width:"10%",render:function(t){return L.a.createElement("span",null,L.a.createElement("a",{onClick:function(a){a&&a.preventDefault(),N["a"].checkAuthAndExecute(e.props.dispatch,Y,function(){return e.openDrawer("02","\u7f16\u8f91",t)},[null])}},"\u7f16\u8f91"),L.a.createElement(s["a"],{type:"vertical"}),L.a.createElement("a",{onClick:function(a){a&&a.preventDefault(),N["a"].checkAuthAndExecute(e.props.dispatch,z,function(){return e.del(t)},[null])}},"\u5220\u9664"))}}],w={labelCol:{xs:{span:24},sm:{span:8}},wrapperCol:{xs:{span:24},sm:{span:16}}},b=L.a.createElement(L.a.Fragment,null,"01"==this.state.type?L.a.createElement(D["a"],c()({},w,{onSubmit:this.handleSubmit}),L.a.createElement(X,{label:L.a.createElement("span",{style:{width:"100px",display:"inline-block"}},"\u76ee\u5f55\u6620\u5c04\u540d\u79f0 ")},t("name")(L.a.createElement("div",null,L.a.createElement(x["a"],{placeholder:"\u8bf7\u8f93\u5165\u76ee\u5f55\u6620\u5c04\u540d\u79f0",style:{width:330}}),L.a.createElement("span",{style:{color:"red",marginLeft:5}},"*")))),L.a.createElement(X,{label:L.a.createElement("span",{style:{width:"80px",display:"inline-block"}},"\u771f\u5b9e\u8def\u5f84 ")},t("path")(L.a.createElement("div",null,L.a.createElement(x["a"],{placeholder:"\u8bf7\u8f93\u5165\u771f\u5b9e\u8def\u5f84",style:{width:330}}),L.a.createElement("span",{style:{color:"red",marginLeft:5}},"*")))),L.a.createElement(X,{label:L.a.createElement("span",{style:{width:"80px",display:"inline-block"}},"\u6620\u5c04\u8bf4\u660e ")},t("desc")(L.a.createElement(Q,{placeholder:"\u8bf7\u8f93\u5165\u6620\u5c04\u8bf4\u660e",style:{width:330}}))),L.a.createElement(X,{label:L.a.createElement("span",{style:{width:"100px",display:"inline-block"}},"\u53ef\u8bfb\u7684\u89d2\u8272 ")},L.a.createElement(C["a"],{mode:"tags",style:{width:330},placeholder:"\u8bf7\u9009\u62e9\u89d2\u8272\uff01",onFocus:function(){return e.showJsgl("readRole")},dropdownStyle:{display:"none"},onChange:function(t){e.handleChange(t,"readRole")},allowClear:!0,value:p?p.map(function(e){return e.name}):void 0})),L.a.createElement(X,{label:L.a.createElement("span",{style:{width:"100px",display:"inline-block"}},"\u53ef\u5199\u7684\u89d2\u8272 ")},L.a.createElement(C["a"],{mode:"tags",style:{width:330},placeholder:"\u8bf7\u9009\u62e9\u89d2\u8272\uff01",onFocus:function(){return e.showJsgl("writeRole")},dropdownStyle:{display:"none"},onChange:function(t){e.handleChange(t,"writeRole")},allowClear:!0,value:m?m.map(function(e){return e.name}):void 0}))):"02"==this.state.type?L.a.createElement(D["a"],c()({},w,{onSubmit:this.handleSubmit}),L.a.createElement(X,{label:L.a.createElement("span",{style:{width:"100px",display:"inline-block"}},"\u76ee\u5f55\u6620\u5c04\u540d\u79f0")},t("name")(L.a.createElement("div",null,L.a.createElement(x["a"],{placeholder:"\u8bf7\u8f93\u5165\u76ee\u5f55\u6620\u5c04\u540d\u79f0",defaultValue:o&&o.name,style:{width:330}}),L.a.createElement("span",{style:{color:"red",marginLeft:5}},"*")))),L.a.createElement(X,{label:L.a.createElement("span",{style:{width:"80px",display:"inline-block"}},"\u771f\u5b9e\u8def\u5f84")},t("path")(L.a.createElement("div",null,L.a.createElement(x["a"],{placeholder:"\u8bf7\u8f93\u5165\u771f\u5b9e\u8def\u5f84",defaultValue:o&&o.path,style:{width:330},disabled:!0}),L.a.createElement("span",{style:{color:"red",marginLeft:5}},"*")))),L.a.createElement(X,{label:L.a.createElement("span",{style:{width:"80px",display:"inline-block"}},"\u6620\u5c04\u8bf4\u660e")},t("desc")(L.a.createElement("div",null,L.a.createElement(Q,{placeholder:"\u8bf7\u8f93\u5165\u6620\u5c04\u8bf4\u660e",defaultValue:o&&o.desc,style:{width:330}})))),L.a.createElement(X,{label:L.a.createElement("span",{style:{width:"100px",display:"inline-block"}},"\u53ef\u8bfb\u7684\u89d2\u8272 ")},L.a.createElement(C["a"],{mode:"tags",style:{width:330},placeholder:"\u8bf7\u9009\u62e9\u89d2\u8272\uff01",onFocus:function(){return e.showJsgl("edit_readRole")},dropdownStyle:{display:"none"},onChange:function(t){e.handleChange(t,"edit_readRole")},allowClear:!0,value:h?h.map(function(e){return e.name}):void 0})),L.a.createElement(X,{label:L.a.createElement("span",{style:{width:"100px",display:"inline-block"}},"\u53ef\u5199\u7684\u89d2\u8272 ")},L.a.createElement(C["a"],{mode:"tags",style:{width:330},placeholder:"\u8bf7\u9009\u62e9\u89d2\u8272\uff01",onFocus:function(){return e.showJsgl("edit_writeRole")},dropdownStyle:{display:"none"},onChange:function(t){e.handleChange(t,"edit_writeRole")},allowClear:!0,value:f?f.map(function(e){return e.name}):void 0}))):L.a.createElement(j["a"],{data:o}));return L.a.createElement("div",null,L.a.createElement("div",{className:V.a.header},L.a.createElement(D["a"],{onSubmit:this.handleSearch,layout:"inline"},L.a.createElement("div",{className:V.a.search},L.a.createElement("div",{className:V.a.cols},L.a.createElement(X,{label:L.a.createElement("span",{style:{width:"100px",display:"inline-block"}},"\u76ee\u5f55\u6620\u5c04\u540d")},t("cx_name")(L.a.createElement(x["a"],{placeholder:"\u8bf7\u8f93\u76ee\u5f55\u6620\u5c04\u540d",style:{width:330}})))),L.a.createElement("div",null,L.a.createElement(i["a"],{type:"primary",onClick:function(t){t&&t.preventDefault(),N["a"].checkAuthAndExecute(e.props.dispatch,G,function(){return e.handleSearch()},[null])}},"\u67e5\u8be2"),L.a.createElement(i["a"],{style:{marginLeft:8},onClick:this.reset},"\u91cd\u7f6e"))))),L.a.createElement("div",{className:V.a.content},L.a.createElement("div",{className:V.a.btns},L.a.createElement(i["a"],{type:"primary",onClick:function(t){t&&t.preventDefault(),N["a"].checkAuthAndExecute(e.props.dispatch,Z,function(){return e.openDrawer("01","\u589e\u52a0\u76ee\u5f55\u6620\u5c04")},[null])}},L.a.createElement(r["a"],{type:"plus"}),"\u589e\u52a0\u76ee\u5f55\u6620\u5c04")),L.a.createElement("div",null,L.a.createElement(l["a"],{columns:g,dataSource:this.state.listDir,loading:this.state.loading,size:"small",pagination:15}))),L.a.createElement(n["a"],{title:L.a.createElement(L.a.Fragment,null,this.state.drawerTitle),onClose:this.drawerClose,visible:this.state.visible,destroyOnClose:!0},b,"03"!=this.state.type?L.a.createElement("div",{style:{position:"absolute",right:0,bottom:0,width:"100%",borderTop:"1px solid #e9e9e9",padding:"10px 16px",background:"#fff",textAlign:"right"}},L.a.createElement(i["a"],{onClick:this.drawerClose,style:{marginRight:8}},"\u53d6\u6d88"),L.a.createElement(i["a"],{type:"primary",onClick:this.handleSubmit},"\u786e\u5b9a")):null),this.state.jsglVisible?L.a.createElement(T["a"],{jsglVisible:this.state.jsglVisible,handleSelectedJsgl:this.getJsglMsg.bind(this),handleJsglVisible:this.closeJsgl.bind(this),selectName:y&&"readRole"==y?p:"writeRole"==y?m:"edit_writeRole"==y?f:h}):null)}}]),a}(A["Component"]));t["default"]=Object(J["connect"])(function(e){return e.mlgl})(D["a"].create()(H))},lZ7h:function(e,t,a){e.exports={header:"antd-pro-pages-script-mlgl-index-header",search:"antd-pro-pages-script-mlgl-index-search",cols:"antd-pro-pages-script-mlgl-index-cols",content:"antd-pro-pages-script-mlgl-index-content",btns:"antd-pro-pages-script-mlgl-index-btns",bar:"antd-pro-pages-script-mlgl-index-bar",back:"antd-pro-pages-script-mlgl-index-back",drawer:"antd-pro-pages-script-mlgl-index-drawer"}}}]);