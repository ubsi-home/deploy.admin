(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[90],{Hj7g:function(e,t,a){e.exports={header:"antd-pro-pages-eventflow-flow-index-header",search:"antd-pro-pages-eventflow-flow-index-search",cols:"antd-pro-pages-eventflow-flow-index-cols",content:"antd-pro-pages-eventflow-flow-index-content",btns:"antd-pro-pages-eventflow-flow-index-btns",modelMsg:"antd-pro-pages-eventflow-flow-index-modelMsg",check:"antd-pro-pages-eventflow-flow-index-check",arrow:"antd-pro-pages-eventflow-flow-index-arrow",iframe:"antd-pro-pages-eventflow-flow-index-iframe",Drawer:"antd-pro-pages-eventflow-flow-index-Drawer",add_set:"antd-pro-pages-eventflow-flow-index-add_set"}},xXgd:function(e,t,a){"use strict";a.r(t);a("bbsP");var l=a("/wGt"),n=(a("g9YV"),a("wCAj")),i=(a("Pwec"),a("CtXQ")),o=(a("+L6B"),a("2/Rp")),r=a("jehZ"),s=a.n(r),c=(a("7Kak"),a("9yH6")),d=(a("/zsF"),a("PArb")),p=(a("+BJd"),a("mr32")),u=(a("5Dmo"),a("3S7+")),m=(a("miYZ"),a("tsqr")),f=a("2Taf"),w=a.n(f),h=a("vZ4D"),y=a.n(h),E=a("l4Ni"),v=a.n(E),g=a("ujKo"),b=a.n(g),k=a("MhPg"),x=a.n(k),F=(a("2qtc"),a("kLXV")),D=(a("5NDa"),a("5rEg")),C=(a("OaEy"),a("2fM7")),_=(a("y8nQ"),a("Vl3Y")),S=a("q1tI"),V=a.n(S),L=a("wd/R"),N=a.n(L),A=a("MuoO"),M=a("Hj7g"),T=a.n(M),O=(a("IV+2"),a("a2PE"),a("P4xi")),q=a("6Hmz");a("p77/"),a("jX7t"),a("u8op");var j=q["a"].eventFlow_LCGL_FlowCX.key,I=q["a"].eventFlow_LCGL_ADDFlow.key,G=q["a"].eventFlow_LCGL_FlowLCT.key,H=q["a"].eventFlow_LCGL_ProcessCX.key,B=q["a"].eventFlow_LCGL_FlowDel.key,P=_["a"].Item,Y=C["a"].Option,X=D["a"].TextArea,J=(F["a"].confirm,function(e){function t(){var e,a;w()(this,t);for(var l=arguments.length,n=new Array(l),i=0;i<l;i++)n[i]=arguments[i];return a=v()(this,(e=b()(t)).call.apply(e,[this].concat(n))),a.state={scriptList:null,scriptData:null,type:null,visible:!1,visible2:!1,drawerTitle:"",eventOptions:[],status:0},a.queryEvent=function(){a.props.dispatch({type:"flowModel/listEvent",payload:{id:null,domain:null,sortby:["_id",1],skip:0,limit:0},callback:function(e){if("0"==e.code){var t=[];e.data[1]&&e.data[1].forEach(function(e){t.push(V.a.createElement(Y,{key:e._id},e._id))}),console.log("eventOptions=========111111111111\uff1a",t),a.setState({eventOptions:t})}else m["a"].error("\u83b7\u53d6\u5168\u90e8\u4e8b\u4ef6\u51fa\u9519")}}),a.props.dispatch({type:"eventModel/jsonHelp",payload:{},callback:function(e){e?a.setState({ubsiJsonHelp:e.data.split("\n\t\t\t")}):m["a"].error("\u83b7\u53d6UBSI-JSON\u7f16\u7801\u683c\u5f0f\u8bf4\u660e\u51fa\u9519")}})},a.queryFlow=function(){a.props.dispatch({type:"flowModel/listFlow",payload:{name:null,event:null,domain:null,status:null,sortby:["updateTime",-1],skip:0,limit:0},callback:function(e){"0"==e.code?a.setState({scriptList:e.data[1]}):m["a"].error("\u83b7\u53d6\u5168\u90e8\u6d41\u7a0b\u51fa\u9519")}})},a.del=function(e){var t=a.props.dispatch;console.log("===daa=t===",e),F["a"].confirm({title:"\u786e\u8ba4\u5220\u9664 '".concat(e._id?e._id:"\u8be5\u6d41\u7a0b","' \u5417?"),content:"",okText:"\u662f",okType:"danger",cancelText:"\u5426",onOk:function(){t({type:"flowModel/delFlow",payload:{flow:e._id},callback:function(e){"0"==e.code?(m["a"].success("\u6d41\u7a0b\u5220\u9664\u6210\u529f\uff01"),a.queryFlow()):m["a"].error("\u6d41\u7a0b\u5220\u9664\u5931\u8d25\uff01")}})},onCancel:function(){}})},a.openDrawer=function(e,t,l){a.queryFlow();if("03"===e)document.getElementById("iframes");l?a.setState({visible:!0,drawerTitle:t,type:e,scriptData:l}):a.setState({visible:!0,drawerTitle:t,type:e})},a.drawerClose=function(){a.setState({visible:!1,drawerTitle:"",type:null})},a.msgCheck=function(){var e=a.props.form,t=a.state.scriptList,l=e.getFieldValue("flowName")?e.getFieldValue("flowName"):null;if(null!=l){for(var n=!1,i=0;i<t.length;i++)l===t[i].name&&(n=!0);return n?m["a"].warning("\u6d41\u7a0b\u6807\u8bc6\u4e0d\u80fd\u91cd\u590d"):void 0}m["a"].warning("\u6d41\u7a0b\u6807\u8bc6\u5fc5\u586b\uff01")},a.handleSubmit=function(){for(var e=a.props,t=e.form,l=e.dispatch,n=a.state,i=n.scriptList,o=n.status,r=t.getFieldValue("flowDomain")?t.getFieldValue("flowDomain"):null,s=t.getFieldValue("flowName")?t.getFieldValue("flowName"):null,c=t.getFieldValue("flowDesc")?t.getFieldValue("flowDesc"):null,d=!1,p=0;p<i.length;p++)s===i[p].name&&(d=!0);if(d)return m["a"].warning("\u6d41\u7a0b\u6807\u8bc6\u4e0d\u80fd\u91cd\u590d");if("01"==a.state.type){if(null==s)return void m["a"].warning("\u6d41\u7a0b\u6807\u8bc6\u79f0\u5fc5\u586b\uff01");l({type:"flowModel/addFlow",payload:{domain:r,name:s,desc:c,status:o},callback:function(e){"0"==e.code?(m["a"].success("\u65b0\u589e\u6210\u529f"),a.queryFlow(),a.setState({visible:!1})):m["a"].error("\u65b0\u589e\u51fa\u9519")}})}else if("02"==a.state.type){l({type:"flowModel/setFlow",payload:{flow:a.state.scriptData._id,domain:r,name:s,desc:c,status:o},callback:function(e){"0"==e.code?(m["a"].success("\u4fee\u6539\u6210\u529f"),a.queryFlow(),a.setState({visible:!1})):m["a"].error("\u4fee\u6539\u8bf7\u6c42\u51fa\u9519")}})}},a.changeStatus=function(e){console.log("e.target.value==============: ",e.target.value),a.setState({status:e.target.value})},a}return x()(t,e),y()(t,[{key:"componentDidMount",value:function(){this.queryFlow(),this.queryEvent()}},{key:"render",value:function(){var e=this,t=this.state,a=t.scriptData,r=(t.params,t.scriptList),f=t.eventOptions,w=this.props.form.getFieldDecorator,h=[],y=[];r&&r.forEach(function(e){void 0!=e.domain&&y.indexOf(e.domain)<0&&(y.push(e.domain),h.push(V.a.createElement(Y,{key:e.domain},e.domain)))}),console.log("eventOptions===============:",f);var E=[{title:"\u6d41\u7a0b\u6807\u8bc6",align:"center",render:function(t){return V.a.createElement(u["a"],{placement:"top",title:"\u6d41\u7a0b\u63cf\u8ff0\uff1a".concat(void 0==t.desc?"":t.desc)},V.a.createElement("a",{onClick:function(){e.openDrawer("02","\u8be6\u60c5",t)}},t.name))}},{title:"\u54cd\u5e94\u4e8b\u4ef6",dataIndex:"events",align:"center",render:function(e){return V.a.createElement("span",null,e?e.map(function(e){return V.a.createElement(p["a"],{color:"blue",key:e},e)}):[])}},{title:"\u6570\u636e\u57df",align:"center",dataIndex:"domain",render:function(e){return e&&V.a.createElement("span",null,V.a.createElement(p["a"],{color:"blue"},void 0==e?"":e))}},{title:"\u72b6\u6001",dataIndex:"status",align:"center",render:function(e){return V.a.createElement("span",null,"0"==e?"\u6b63\u5e38":"\u505c\u7528")}},{title:"\u65f6\u95f4",dataIndex:"updateTime",align:"center",render:function(e){return V.a.createElement("span",null,e&&N()(e).format("YYYY-MM-DD"),"\xa0",e&&N()(e).format("HH:mm:ss"))}},{title:"\u64cd\u4f5c",align:"center",width:"20%",render:function(t){return V.a.createElement("span",null,V.a.createElement("a",{onClick:function(a){a&&a.preventDefault(),O["a"].checkAuthAndExecute(e.props.dispatch,G,function(){return e.openDrawer("03",t.name,t)},[null])}},"\u6d41\u7a0b\u56fe"),V.a.createElement(d["a"],{type:"vertical"}),V.a.createElement("a",{onClick:function(a){a&&a.preventDefault(),O["a"].checkAuthAndExecute(e.props.dispatch,H,function(){e.props.history.push({pathname:"/admin/process",params:t})},[null])}},"\u6d41\u7a0b\u5b9e\u4f8b"),V.a.createElement(d["a"],{type:"vertical"}),V.a.createElement("a",{onClick:function(a){a&&a.preventDefault(),O["a"].checkAuthAndExecute(e.props.dispatch,B,function(){return e.del(t)},[])}},"\u5220\u9664"))}}],v=function(){var t=e.props,a=t.form,l=(t.dispatch,a.getFieldValue("cx_flowName")?a.getFieldValue("cx_flowName"):null),n=a.getFieldValue("cx_flowEvent")?a.getFieldValue("cx_flowEvent"):null,i=a.getFieldValue("cx_flowDomain")?a.getFieldValue("cx_flowDomain"):[],o=void 0!=a.getFieldValue("cx_flowStatus")?a.getFieldValue("cx_flowStatus"):0;o=1==o?null:o,l&&(l=".*".concat(l,".*")),n&&(n=".*".concat(n,".*")),console.log(i.length,n),e.props.dispatch({type:"flowModel/listFlow",payload:{name:l,domain:i.length>0?i.join():null,event:n||null,status:o,sortby:["updateTime",-1],skip:0,limit:0},callback:function(t){"0"==t.code?(e.setState({scriptList:t.data[1]}),m["a"].success("\u67e5\u8be2\u6210\u529f")):m["a"].error("\u67e5\u8be2\u51fa\u9519")}})},g=function(){var t=e.props,a=t.form;t.dispatch;a.resetFields(),e.queryFlow(),m["a"].success("\u91cd\u7f6e\u6210\u529f")},b={labelCol:{xs:{span:24},sm:{span:8}},wrapperCol:{xs:{span:24},sm:{span:16}}},k="01"==this.state.type?V.a.createElement(_["a"],s()({className:T.a.add_set},b,{onSubmit:this.handleSubmit}),V.a.createElement(P,{label:V.a.createElement("span",{style:{width:"60px",display:"inline-block"}},"\u6d41\u7a0b\u6807\u8bc6")},w("flowName")(V.a.createElement("div",null,V.a.createElement(D["a"],{placeholder:"\u8bf7\u8f93\u5165\u6d41\u7a0b\u6807\u8bc6",onBlur:this.msgCheck,style:{width:300}}),V.a.createElement("span",{style:{color:"red"}},"*")))),V.a.createElement(P,{label:V.a.createElement("span",{style:{width:"70px",display:"inline-block"}},"\u6d41\u7a0b\u6570\u636e\u57df")},w("flowDomain")(V.a.createElement(D["a"],{placeholder:"\u8bf7\u8f93\u5165\u6d41\u7a0b\u6570\u636e\u57df",style:{width:300}}))),V.a.createElement(P,{label:V.a.createElement("span",{style:{width:"60px",display:"inline-block"}},"\u6d41\u7a0b\u63cf\u8ff0")},w("flowDesc")(V.a.createElement(X,{placeholder:"\u8bf7\u8f93\u5165\u4e8b\u4ef6\u63cf\u8ff0",style:{width:300}}))),V.a.createElement(P,{label:V.a.createElement("span",{style:{width:"60px",display:"inline-block"}},"\u6d41\u7a0b\u72b6\u6001")},V.a.createElement(c["a"].Group,{onChange:this.changeStatus,defaultValue:0},V.a.createElement(c["a"],{value:0},"\u6b63\u5e38"),V.a.createElement(c["a"],{value:-1},"\u505c\u7528")))):"02"==this.state.type?V.a.createElement(_["a"],s()({className:T.a.add_set},b,{onSubmit:this.handleSubmit}),V.a.createElement(P,{label:V.a.createElement("span",{style:{width:"60px",display:"inline-block"}},"\u6d41\u7a0b\u6807\u8bc6")},V.a.createElement("div",null,V.a.createElement(D["a"],{placeholder:"\u8bf7\u8f93\u5165\u6d41\u7a0b\u6807\u8bc6",defaultValue:a&&a.name,onBlur:this.msgCheck,style:{width:300},disabled:!0}),V.a.createElement("span",{style:{color:"red"}},"*"))),V.a.createElement(P,{label:V.a.createElement("span",{style:{width:"70px",display:"inline-block"}},"\u6d41\u7a0b\u6570\u636e\u57df")},w("flowDomain",{initialValue:a&&a.domain})(V.a.createElement(D["a"],{placeholder:"\u8bf7\u8f93\u5165\u6d41\u7a0b\u6570\u636e\u57df",style:{width:300}}))),V.a.createElement(P,{label:V.a.createElement("span",{style:{width:"60px",display:"inline-block"}},"\u4e8b\u4ef6\u63cf\u8ff0")},w("flowDesc",{initialValue:a&&a.desc})(V.a.createElement(X,{placeholder:"\u8bf7\u8f93\u5165\u4e8b\u4ef6\u63cf\u8ff0",style:{width:300}}))),V.a.createElement(P,{label:V.a.createElement("span",{style:{width:"60px",display:"inline-block"}},"\u6d41\u7a0b\u72b6\u6001")},V.a.createElement(c["a"].Group,{onChange:this.changeStatus,defaultValue:a&&a.status},V.a.createElement(c["a"],{value:0},"\u6b63\u5e38"),V.a.createElement(c["a"],{value:-1},"\u505c\u7528")))):"03"==this.state.type?V.a.createElement("iframe",{id:"iframes",src:"/eventflow/#/flow/{'id':'".concat(a._id,"','url':'/rest','token':'").concat(O["a"].getRoleToken(),"'}"),className:T.a.iframe},"\u6d41\u7a0b\u56fe"):"04"==this.state.type?V.a.createElement("div",null,"\u6d41\u7a0b\u5b9e\u4f8b"):null;return V.a.createElement("div",null,V.a.createElement("div",{className:T.a.header},V.a.createElement(_["a"],{layout:"inline"},V.a.createElement("div",{className:T.a.search},V.a.createElement("div",null,V.a.createElement("div",{className:T.a.cols},V.a.createElement(P,{label:V.a.createElement("span",{style:{width:"60px",display:"inline-block"}},"\u6d41\u7a0b\u6807\u8bc6")},w("cx_flowName")(V.a.createElement(D["a"],{placeholder:"\u8bf7\u8f93\u5165\u6d41\u7a0b\u6807\u8bc6",style:{width:300}}))),V.a.createElement(P,{label:V.a.createElement("span",{style:{width:"60px",display:"inline-block"}},"\u6570\u636e\u57df")},w("cx_flowDomain")(V.a.createElement(C["a"],{mode:"tags",style:{width:"300px"},placeholder:"\u8bf7\u9009\u62e9\u60f3\u8981\u67e5\u8be2\u7684\u6570\u636e\u57df\uff01",allowClear:!0},h)))),V.a.createElement("div",{className:T.a.cols},V.a.createElement(P,{label:V.a.createElement("span",{style:{width:"60px",display:"inline-block"}},"\u54cd\u5e94\u4e8b\u4ef6")},w("cx_flowEvent")(V.a.createElement(C["a"],{mode:"tags",style:{width:"300px"},placeholder:"\u8bf7\u9009\u62e9\u60f3\u8981\u67e5\u8be2\u7684\u54cd\u5e94\u4e8b\u4ef6\uff01",allowClear:!0},f))),V.a.createElement(P,{label:V.a.createElement("span",{style:{width:"60px",display:"inline-block"}},"\u6d41\u7a0b\u72b6\u6001")},w("cx_flowStatus")(V.a.createElement(C["a"],{style:{width:"300px"},placeholder:"\u8bf7\u9009\u62e9\u60f3\u8981\u67e5\u8be2\u7684\u72b6\u6001\uff01",allowClear:!0},V.a.createElement(Y,{value:1},"\u5168\u90e8"),V.a.createElement(Y,{value:0},"\u6b63\u5e38"),V.a.createElement(Y,{value:-1},"\u505c\u7528")))))),V.a.createElement("span",{className:T.a.submitButtons},V.a.createElement(o["a"],{type:"primary",onClick:function(t){t&&t.preventDefault(),O["a"].checkAuthAndExecute(e.props.dispatch,j,v,[null])}},"\u67e5\u8be2"),V.a.createElement(o["a"],{style:{marginLeft:8},onClick:g},"\u91cd\u7f6e"))))),V.a.createElement("div",{className:T.a.content},V.a.createElement("div",{className:T.a.btns},V.a.createElement(o["a"],{type:"primary",onClick:function(t){t&&t.preventDefault(),O["a"].checkAuthAndExecute(e.props.dispatch,I,function(){return e.openDrawer("01","\u65b0\u589e\u6d41\u7a0b")},[null])}},V.a.createElement(i["a"],{type:"plus"}),"\u65b0\u589e\u6d41\u7a0b")),V.a.createElement("div",null,V.a.createElement(n["a"],{columns:E,dataSource:this.state.scriptList,size:"small",rowKey:this.state.scriptList&&this.state.scriptList.length>0?this.state.scriptList._id:""}))),V.a.createElement(l["a"],{title:this.state.drawerTitle,onClose:this.drawerClose,visible:this.state.visible,destroyOnClose:!0,className:T.a.Drawer},k,"03"!=this.state.type?V.a.createElement("div",{style:{position:"absolute",right:0,bottom:0,width:"100%",borderTop:"1px solid #e9e9e9",padding:"10px 16px",background:"#fff",textAlign:"right"}},V.a.createElement(o["a"],{onClick:this.drawerClose,style:{marginRight:8}},"\u53d6\u6d88"),V.a.createElement(o["a"],{type:"primary",onClick:this.handleSubmit},"\u786e\u5b9a")):null))}}]),t}(S["Component"]));t["default"]=Object(A["connect"])(function(e){return e.flowModel})(_["a"].create()(J))}}]);