(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[90],{Hj7g:function(e,t,a){e.exports={header:"antd-pro-pages-eventflow-flow-index-header",search:"antd-pro-pages-eventflow-flow-index-search",cols:"antd-pro-pages-eventflow-flow-index-cols",content:"antd-pro-pages-eventflow-flow-index-content",btns:"antd-pro-pages-eventflow-flow-index-btns",modelMsg:"antd-pro-pages-eventflow-flow-index-modelMsg",check:"antd-pro-pages-eventflow-flow-index-check",arrow:"antd-pro-pages-eventflow-flow-index-arrow",iframe:"antd-pro-pages-eventflow-flow-index-iframe",Drawer:"antd-pro-pages-eventflow-flow-index-Drawer",add_set:"antd-pro-pages-eventflow-flow-index-add_set"}},xXgd:function(e,t,a){"use strict";a.r(t);a("bbsP");var l=a("/wGt"),n=(a("g9YV"),a("wCAj")),r=(a("Pwec"),a("CtXQ")),i=(a("+L6B"),a("2/Rp")),o=a("jehZ"),c=a.n(o),s=(a("7Kak"),a("9yH6")),d=(a("/zsF"),a("PArb")),p=(a("+BJd"),a("mr32")),u=(a("5Dmo"),a("3S7+")),m=(a("miYZ"),a("tsqr")),f=a("2Taf"),w=a.n(f),h=a("vZ4D"),y=a.n(h),E=a("MhPg"),v=a.n(E),g=a("l4Ni"),b=a.n(g),k=a("ujKo"),x=a.n(k),F=(a("2qtc"),a("kLXV")),D=(a("5NDa"),a("5rEg")),C=(a("OaEy"),a("2fM7")),_=(a("y8nQ"),a("Vl3Y")),L=a("q1tI"),S=a.n(L),V=a("wd/R"),N=a.n(V),A=a("MuoO"),M=a("Hj7g"),T=a.n(M),q=(a("IV+2"),a("a2PE"),a("P4xi")),O=a("6Hmz");function j(e){var t=B();return function(){var a,l=x()(e);if(t){var n=x()(this).constructor;a=Reflect.construct(l,arguments,n)}else a=l.apply(this,arguments);return b()(this,a)}}function B(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}a("p77/"),a("jX7t"),a("u8op");var G=O["a"].eventFlow_LCGL_FlowCX.key,I=O["a"].eventFlow_LCGL_ADDFlow.key,R=O["a"].eventFlow_LCGL_editFlow.key,H=O["a"].eventFlow_LCGL_FlowLCT.key,P=O["a"].eventFlow_LCGL_ProcessCX.key,Y=O["a"].eventFlow_LCGL_FlowDel.key,X=_["a"].Item,J=C["a"].Option,z=D["a"].TextArea,K=(F["a"].confirm,function(e){v()(a,e);var t=j(a);function a(){var e;w()(this,a);for(var l=arguments.length,n=new Array(l),r=0;r<l;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n)),e.state={scriptList:null,scriptData:null,type:null,visible:!1,visible2:!1,drawerTitle:"",eventOptions:[],status:0},e.queryEvent=function(){e.props.dispatch({type:"flowModel/listEvent",payload:{id:null,domain:null,sortby:["_id",1],skip:0,limit:0},callback:function(t){if("0"==t.code){var a=[];t.data[1]&&t.data[1].forEach(function(e){a.push(S.a.createElement(J,{key:e._id},e._id))}),console.log("eventOptions=========111111111111\uff1a",a),e.setState({eventOptions:a})}else m["a"].error("\u83b7\u53d6\u5168\u90e8\u4e8b\u4ef6\u51fa\u9519")}}),e.props.dispatch({type:"eventModel/jsonHelp",payload:{},callback:function(t){t?e.setState({ubsiJsonHelp:t.data.split("\n\t\t\t")}):m["a"].error("\u83b7\u53d6UBSI-JSON\u7f16\u7801\u683c\u5f0f\u8bf4\u660e\u51fa\u9519")}})},e.queryFlow=function(){e.props.dispatch({type:"flowModel/listFlow",payload:{name:null,event:null,domain:null,status:null,sortby:["updateTime",-1],skip:0,limit:0},callback:function(t){"0"==t.code?e.setState({scriptList:t.data[1]}):m["a"].error("\u83b7\u53d6\u5168\u90e8\u6d41\u7a0b\u51fa\u9519")}})},e.del=function(t){var a=e.props.dispatch;console.log("===daa=t===",t),F["a"].confirm({title:"\u786e\u8ba4\u5220\u9664 '".concat(t._id?t._id:"\u8be5\u6d41\u7a0b","' \u5417?"),content:"",okText:"\u662f",okType:"danger",cancelText:"\u5426",onOk:function(){a({type:"flowModel/delFlow",payload:{flow:t._id,reqData:t},callback:function(t){"0"==t.code?(m["a"].success("\u6d41\u7a0b\u5220\u9664\u6210\u529f\uff01"),e.queryFlow()):m["a"].error("\u6d41\u7a0b\u5220\u9664\u5931\u8d25\uff01")}})},onCancel:function(){}})},e.openDrawer=function(t,a,l){e.queryFlow();if("03"===t)document.getElementById("iframes");l?e.setState({visible:!0,drawerTitle:a,type:t,scriptData:l}):e.setState({visible:!0,drawerTitle:a,type:t})},e.drawerClose=function(){e.setState({visible:!1,drawerTitle:"",type:null})},e.msgCheck=function(){var t=e.props.form,a=e.state.scriptList,l=t.getFieldValue("flowName")?t.getFieldValue("flowName"):null;if(null!=l){for(var n=!1,r=0;r<a.length;r++)l===a[r].name&&(n=!0);return n?m["a"].warning("\u6d41\u7a0b\u6807\u8bc6\u4e0d\u80fd\u91cd\u590d"):void 0}m["a"].warning("\u6d41\u7a0b\u6807\u8bc6\u5fc5\u586b\uff01")},e.handleSubmit=function(){for(var t=e.props,a=t.form,l=t.dispatch,n=e.state,r=n.scriptList,i=n.status,o=a.getFieldValue("flowDomain")?a.getFieldValue("flowDomain"):null,c=a.getFieldValue("flowName")?a.getFieldValue("flowName"):null,s=a.getFieldValue("flowDesc")?a.getFieldValue("flowDesc"):null,d=!1,p=0;p<r.length;p++)c===r[p].name&&(d=!0);if(d)return m["a"].warning("\u6d41\u7a0b\u6807\u8bc6\u4e0d\u80fd\u91cd\u590d");if("01"==e.state.type){if(null==c)return void m["a"].warning("\u6d41\u7a0b\u6807\u8bc6\u79f0\u5fc5\u586b\uff01");l({type:"flowModel/addFlow",payload:{domain:o,name:c,desc:s,status:i},callback:function(t){"0"==t.code?(m["a"].success("\u65b0\u589e\u6210\u529f"),e.queryFlow(),e.setState({visible:!1})):m["a"].error("\u65b0\u589e\u51fa\u9519")}})}else if("02"==e.state.type){l({type:"flowModel/setFlow",payload:{flow:e.state.scriptData._id,domain:o,name:c,desc:s,status:i,reqData:e.state.scriptData},callback:function(t){"0"==t.code?(m["a"].success("\u4fee\u6539\u6210\u529f"),e.queryFlow(),e.setState({visible:!1})):m["a"].error("\u4fee\u6539\u8bf7\u6c42\u51fa\u9519")}})}},e.changeStatus=function(t){console.log("e.target.value==============: ",t.target.value),e.setState({status:t.target.value})},e}return y()(a,[{key:"componentDidMount",value:function(){this.queryFlow(),this.queryEvent()}},{key:"render",value:function(){var e=this,t=this.state,a=t.scriptData,o=(t.params,t.scriptList),f=t.eventOptions,w=this.props.form.getFieldDecorator,h=[],y=[];o&&o.forEach(function(e){void 0!=e.domain&&y.indexOf(e.domain)<0&&(y.push(e.domain),h.push(S.a.createElement(J,{key:e.domain},e.domain)))}),console.log("eventOptions===============:",f);var E=[{title:"\u6d41\u7a0b\u6807\u8bc6",align:"center",render:function(t){return S.a.createElement(u["a"],{placement:"top",title:"\u6d41\u7a0b\u63cf\u8ff0\uff1a".concat(void 0==t.desc?"":t.desc)},S.a.createElement("a",{onClick:function(a){a&&a.preventDefault(),q["a"].checkAuthAndExecute(e.props.dispatch,R,function(){return e.openDrawer("02","\u8be6\u60c5",t)},[null])}},t.name))}},{title:"\u54cd\u5e94\u4e8b\u4ef6",dataIndex:"events",align:"center",render:function(e){return S.a.createElement("span",null,e?e.map(function(e){return S.a.createElement(p["a"],{color:"blue",key:e},e)}):[])}},{title:"\u6570\u636e\u57df",align:"center",dataIndex:"domain",render:function(e){return e&&S.a.createElement("span",null,S.a.createElement(p["a"],{color:"blue"},void 0==e?"":e))}},{title:"\u72b6\u6001",dataIndex:"status",align:"center",render:function(e){return S.a.createElement("span",null,"0"==e?"\u6b63\u5e38":"\u505c\u7528")}},{title:"\u65f6\u95f4",dataIndex:"updateTime",align:"center",render:function(e){return S.a.createElement("span",null,e&&N()(e).format("YYYY-MM-DD"),"\xa0",e&&N()(e).format("HH:mm:ss"))}},{title:"\u64cd\u4f5c",align:"center",width:"20%",render:function(t){return S.a.createElement("span",null,S.a.createElement("a",{onClick:function(a){a&&a.preventDefault(),q["a"].checkAuthAndExecute(e.props.dispatch,H,function(){return e.openDrawer("03",t.name,t)},[null])}},"\u6d41\u7a0b\u56fe"),S.a.createElement(d["a"],{type:"vertical"}),S.a.createElement("a",{onClick:function(a){a&&a.preventDefault(),q["a"].checkAuthAndExecute(e.props.dispatch,P,function(){e.props.history.push({pathname:"/admin/process",params:t})},[null])}},"\u6d41\u7a0b\u5b9e\u4f8b"),S.a.createElement(d["a"],{type:"vertical"}),S.a.createElement("a",{onClick:function(a){a&&a.preventDefault(),q["a"].checkAuthAndExecute(e.props.dispatch,Y,function(){return e.del(t)},[])}},"\u5220\u9664"))}}],v=function(){var t=e.props,a=t.form,l=(t.dispatch,a.getFieldValue("cx_flowName")?a.getFieldValue("cx_flowName"):null),n=a.getFieldValue("cx_flowEvent")?a.getFieldValue("cx_flowEvent"):null,r=a.getFieldValue("cx_flowDomain")?a.getFieldValue("cx_flowDomain"):[],i=void 0!=a.getFieldValue("cx_flowStatus")?a.getFieldValue("cx_flowStatus"):0;i=1==i?null:i,l&&(l=".*".concat(l,".*")),n&&(n=".*".concat(n,".*")),console.log(r.length,n),e.props.dispatch({type:"flowModel/listFlow",payload:{name:l,domain:r.length>0?r.join():null,event:n||null,status:i,sortby:["updateTime",-1],skip:0,limit:0},callback:function(t){"0"==t.code?(e.setState({scriptList:t.data[1]}),m["a"].success("\u67e5\u8be2\u6210\u529f")):m["a"].error("\u67e5\u8be2\u51fa\u9519")}})},g=function(){var t=e.props,a=t.form;t.dispatch;a.resetFields(),e.queryFlow(),m["a"].success("\u91cd\u7f6e\u6210\u529f")},b={labelCol:{xs:{span:24},sm:{span:8}},wrapperCol:{xs:{span:24},sm:{span:16}}},k="01"==this.state.type?S.a.createElement(_["a"],c()({className:T.a.add_set},b,{onSubmit:this.handleSubmit}),S.a.createElement(X,{label:S.a.createElement("span",{style:{width:"60px",display:"inline-block"}},"\u6d41\u7a0b\u6807\u8bc6")},w("flowName")(S.a.createElement("div",null,S.a.createElement(D["a"],{placeholder:"\u8bf7\u8f93\u5165\u6d41\u7a0b\u6807\u8bc6",onBlur:this.msgCheck,style:{width:300}}),S.a.createElement("span",{style:{color:"red"}},"*")))),S.a.createElement(X,{label:S.a.createElement("span",{style:{width:"70px",display:"inline-block"}},"\u6d41\u7a0b\u6570\u636e\u57df")},w("flowDomain")(S.a.createElement(D["a"],{placeholder:"\u8bf7\u8f93\u5165\u6d41\u7a0b\u6570\u636e\u57df",style:{width:300}}))),S.a.createElement(X,{label:S.a.createElement("span",{style:{width:"60px",display:"inline-block"}},"\u6d41\u7a0b\u63cf\u8ff0")},w("flowDesc")(S.a.createElement(z,{placeholder:"\u8bf7\u8f93\u5165\u4e8b\u4ef6\u63cf\u8ff0",style:{width:300}}))),S.a.createElement(X,{label:S.a.createElement("span",{style:{width:"60px",display:"inline-block"}},"\u6d41\u7a0b\u72b6\u6001")},S.a.createElement(s["a"].Group,{onChange:this.changeStatus,defaultValue:0},S.a.createElement(s["a"],{value:0},"\u6b63\u5e38"),S.a.createElement(s["a"],{value:-1},"\u505c\u7528")))):"02"==this.state.type?S.a.createElement(_["a"],c()({className:T.a.add_set},b,{onSubmit:this.handleSubmit}),S.a.createElement(X,{label:S.a.createElement("span",{style:{width:"60px",display:"inline-block"}},"\u6d41\u7a0b\u6807\u8bc6")},S.a.createElement("div",null,S.a.createElement(D["a"],{placeholder:"\u8bf7\u8f93\u5165\u6d41\u7a0b\u6807\u8bc6",defaultValue:a&&a.name,onBlur:this.msgCheck,style:{width:300},disabled:!0}),S.a.createElement("span",{style:{color:"red"}},"*"))),S.a.createElement(X,{label:S.a.createElement("span",{style:{width:"70px",display:"inline-block"}},"\u6d41\u7a0b\u6570\u636e\u57df")},w("flowDomain",{initialValue:a&&a.domain})(S.a.createElement(D["a"],{placeholder:"\u8bf7\u8f93\u5165\u6d41\u7a0b\u6570\u636e\u57df",style:{width:300}}))),S.a.createElement(X,{label:S.a.createElement("span",{style:{width:"60px",display:"inline-block"}},"\u4e8b\u4ef6\u63cf\u8ff0")},w("flowDesc",{initialValue:a&&a.desc})(S.a.createElement(z,{placeholder:"\u8bf7\u8f93\u5165\u4e8b\u4ef6\u63cf\u8ff0",style:{width:300}}))),S.a.createElement(X,{label:S.a.createElement("span",{style:{width:"60px",display:"inline-block"}},"\u6d41\u7a0b\u72b6\u6001")},S.a.createElement(s["a"].Group,{onChange:this.changeStatus,defaultValue:a&&a.status},S.a.createElement(s["a"],{value:0},"\u6b63\u5e38"),S.a.createElement(s["a"],{value:-1},"\u505c\u7528")))):"03"==this.state.type?S.a.createElement("iframe",{id:"iframes",src:"/eventflow/#/flow/{'id':'".concat(a._id,"','url':'/rest','token':'").concat(q["a"].getRoleToken(),"'}"),className:T.a.iframe},"\u6d41\u7a0b\u56fe"):"04"==this.state.type?S.a.createElement("div",null,"\u6d41\u7a0b\u5b9e\u4f8b"):null;return S.a.createElement("div",null,S.a.createElement("div",{className:T.a.header},S.a.createElement(_["a"],{layout:"inline"},S.a.createElement("div",{className:T.a.search},S.a.createElement("div",null,S.a.createElement("div",{className:T.a.cols},S.a.createElement(X,{label:S.a.createElement("span",{style:{width:"60px",display:"inline-block"}},"\u6d41\u7a0b\u6807\u8bc6")},w("cx_flowName")(S.a.createElement(D["a"],{placeholder:"\u8bf7\u8f93\u5165\u6d41\u7a0b\u6807\u8bc6",style:{width:300}}))),S.a.createElement(X,{label:S.a.createElement("span",{style:{width:"60px",display:"inline-block"}},"\u6570\u636e\u57df")},w("cx_flowDomain")(S.a.createElement(C["a"],{mode:"tags",style:{width:"300px"},placeholder:"\u8bf7\u9009\u62e9\u60f3\u8981\u67e5\u8be2\u7684\u6570\u636e\u57df\uff01",allowClear:!0},h)))),S.a.createElement("div",{className:T.a.cols},S.a.createElement(X,{label:S.a.createElement("span",{style:{width:"60px",display:"inline-block"}},"\u54cd\u5e94\u4e8b\u4ef6")},w("cx_flowEvent")(S.a.createElement(C["a"],{mode:"tags",style:{width:"300px"},placeholder:"\u8bf7\u9009\u62e9\u60f3\u8981\u67e5\u8be2\u7684\u54cd\u5e94\u4e8b\u4ef6\uff01",allowClear:!0},f))),S.a.createElement(X,{label:S.a.createElement("span",{style:{width:"60px",display:"inline-block"}},"\u6d41\u7a0b\u72b6\u6001")},w("cx_flowStatus")(S.a.createElement(C["a"],{style:{width:"300px"},placeholder:"\u8bf7\u9009\u62e9\u60f3\u8981\u67e5\u8be2\u7684\u72b6\u6001\uff01",allowClear:!0},S.a.createElement(J,{value:1},"\u5168\u90e8"),S.a.createElement(J,{value:0},"\u6b63\u5e38"),S.a.createElement(J,{value:-1},"\u505c\u7528")))))),S.a.createElement("span",{className:T.a.submitButtons},S.a.createElement(i["a"],{type:"primary",onClick:function(t){t&&t.preventDefault(),q["a"].checkAuthAndExecute(e.props.dispatch,G,v,[null])}},"\u67e5\u8be2"),S.a.createElement(i["a"],{style:{marginLeft:8},onClick:g},"\u91cd\u7f6e"))))),S.a.createElement("div",{className:T.a.content},S.a.createElement("div",{className:T.a.btns},S.a.createElement(i["a"],{type:"primary",onClick:function(t){t&&t.preventDefault(),q["a"].checkAuthAndExecute(e.props.dispatch,I,function(){return e.openDrawer("01","\u65b0\u589e\u6d41\u7a0b")},[null])}},S.a.createElement(r["a"],{type:"plus"}),"\u65b0\u589e\u6d41\u7a0b")),S.a.createElement("div",null,S.a.createElement(n["a"],{columns:E,dataSource:this.state.scriptList,size:"small",rowKey:this.state.scriptList&&this.state.scriptList.length>0?this.state.scriptList._id:""}))),S.a.createElement(l["a"],{title:this.state.drawerTitle,onClose:this.drawerClose,visible:this.state.visible,destroyOnClose:!0,className:T.a.Drawer},k,"03"!=this.state.type?S.a.createElement("div",{style:{position:"absolute",right:0,bottom:0,width:"100%",borderTop:"1px solid #e9e9e9",padding:"10px 16px",background:"#fff",textAlign:"right"}},S.a.createElement(i["a"],{onClick:this.drawerClose,style:{marginRight:8}},"\u53d6\u6d88"),S.a.createElement(i["a"],{type:"primary",onClick:this.handleSubmit},"\u786e\u5b9a")):null))}}]),a}(L["Component"]));t["default"]=Object(A["connect"])(function(e){return e.flowModel})(_["a"].create()(K))}}]);